<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CMPT756 Prjoect</title>
    <script>
    function generateImage() {
    var start = performance.now();
    var num_images = document.getElementById("num_images").value;

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/generate", true);
    xhr.setRequestHeader("Content-Type", "application/json");


    xhr.onload = function () {
        if (xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            var end = performance.now();
            var duration = (end - start).toFixed(6);
            if(response.time){
                var process_time = parseFloat(response.time); 
                var latency = (duration - process_time).toFixed(2);
            }
            else
            {
                console.error('Error in response', response.error);
            }
            document.getElementById('trip-time').innerHTML = '<p>Round trip time: '+ duration + ' ms</br>Process Time: '+process_time+' ms</br>Latency Time: '+latency +' ms</p>';
            console.log("Round trip time: " + duration + "ms");
            console.log("Process time: " + process_time + "ms");
            if (response.src) {
                var src = 'data:image/png;base64,' + response.src;
                document.getElementById('generated-image').innerHTML = '<img src="' + src + '" alt="Generated Image" style="width: 50%;">';
            } else {
                console.error('Error in response', response.error);
            }
        } else {
            console.error("Error", xhr.statusText);
        }
    };


    {#var data = JSON.stringify({ "num_images": num_images, "start_time": start.getTime() / 1000 });#}
     var data = JSON.stringify({ "num_images": num_images});
    xhr.send(data);
    return false;
}


    </script>
</head>
<body>
    <h1>Generated image</h1>
    <form onsubmit="return generateImage()">
        <label for="num_images">Number of image:</label><br>
        <input type="text" id="num_images" name="num_images"><br>
        <input type="submit" value="Go!">
    </form>
    <h2>Time:</h2>
    <div id="trip-time"></div>
    <h2>Image:</h2>
    <div id="generated-image"></div>
</body>
</html>